---
import { storyblokEditable } from "@storyblok/astro";
import StoryblokComponent from "@storyblok/astro/StoryblokComponent.astro";
import FilterBar from "../../components/ui/FilterBar.astro";

const { blok } = Astro.props;

// Extraheer unieke locaties uit de kolommen voor de filters
const locations: string[] = [
  ...new Set(
    blok.columns?.map((col: any) => col.Locatie || col.locatie).filter(Boolean),
  ),
] as string[];
const hasFilters = locations.length > 0;
---

<section
  {...storyblokEditable(blok)}
  class="section-spacing relative overflow-hidden"
  x-data="{ activeFilter: 'all' }"
>
  <!-- Decorative corner accents -->
  <div class="decorative-orb-primary top-10 left-10"></div>
  <div class="decorative-orb-accent bottom-10 right-10"></div>

  <div class="container-custom">
    <div class="text-center max-w-4xl mx-auto mb-20">
      {
        blok.TitelProgramma && (
          <div
            class="inline-flex items-center gap-3 px-5 py-2 rounded-full shadow-sm mb-8"
            style="background: var(--bg-base); border: 1px solid var(--border-primary);"
          >
            <span class="relative flex h-2 w-2">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-secondary opacity-75" />
              <span class="relative inline-flex rounded-full h-2 w-2 bg-secondary" />
            </span>
            <span
              class="font-black text-xs uppercase tracking-[0.2em]"
              style="color: var(--color-primary);"
            >
              {blok.TitelProgramma}
            </span>
          </div>
        )
      }

      {
        (blok.Subheadline || blok.subheadline) && (
          <h2
            class="text-4xl md:text-7xl font-black mb-8 tracking-tighter leading-none"
            style="color: var(--text-primary);"
          >
            {new Date(blok.Subheadline || blok.subheadline).toLocaleDateString(
              "nl-NL",
              {
                weekday: "long",
                day: "numeric",
                month: "long",
              },
            )}
          </h2>
        )
      }

      <div class="flex justify-center items-center gap-4 mb-10">
        <div class="h-px w-20 bg-gradient-to-r from-transparent to-gray-300">
        </div>
        <div
          class="font-black text-xl italic tracking-tighter"
          style="color: var(--color-accent);"
        >
          2026
        </div>
        <div class="h-px w-20 bg-gradient-to-l from-transparent to-gray-300">
        </div>
      </div>

      {
        blok.headline && blok.headline !== blok.TitelProgramma && (
          <p
            class="text-xl md:text-2xl font-medium max-w-2xl mx-auto leading-relaxed"
            style="color: var(--text-secondary);"
          >
            {blok.headline}
          </p>
        )
      }
    </div>

    {/* Filter Bar with Glassmorphism */}
    {
      hasFilters && (
        <FilterBar
          locations={locations}
          showCount={false}
          gradientVariant="blue"
          spacing="lg"
        />
      )
    }

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 lg:gap-10">
      {
        blok.columns?.map((col: any) => {
          const location = col.Locatie || col.locatie || "all";
          return (
            <div
              class="flex justify-center transition-all duration-500"
              x-show={`activeFilter === 'all' || activeFilter === '${location}'`}
              x-transition:enter="transition ease-out duration-300"
              x-transition:enter-start="opacity-0 scale-95"
              x-transition:enter-end="opacity-100 scale-100"
            >
              <StoryblokComponent blok={col} />
            </div>
          );
        })
      }
    </div>
  </div>
</section>
