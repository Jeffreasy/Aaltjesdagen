---
import { storyblokEditable } from '@storyblok/astro'
import StoryblokComponent from '@storyblok/astro/StoryblokComponent.astro'

const { blok } = Astro.props

// Bepaal de dagtitel dynamisch (Dag1Titel, Dag2Titel, of Dag3Titel)
const dagTitel = blok.Dag1Titel || blok.Dag2Titel || blok.Dag3Titel

// Extraheer unieke locaties uit de Programmas voor de filters
const locations = [...new Set(blok.Programmas?.map((prog: any) => prog.Locatie || prog.locatie).filter(Boolean))]
const hasFilters = locations.length > 0
---

<section
  {...storyblokEditable(blok)}
  class="py-24 bg-gray-50/50"
  x-data="{ activeFilter: 'all' }"
>
  <div class="container-custom">
    <div class="text-center max-w-4xl mx-auto mb-16">
      {blok.TitelProgramma && (
        <div class="inline-flex items-center gap-3 bg-white border border-gray-200 px-5 py-2 rounded-full shadow-sm mb-8">
          <span class="relative flex h-2 w-2">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-secondary opacity-75"></span>
            <span class="relative inline-flex rounded-full h-2 w-2 bg-secondary"></span>
          </span>
          <span class="text-primary font-black text-xs uppercase tracking-[0.2em]">
            {blok.TitelProgramma}
          </span>
        </div>
      )}
      
      {dagTitel && (
        <h2 class="text-4xl md:text-7xl font-black text-gray-900 mb-8 tracking-tighter leading-none">
          {new Date(dagTitel).toLocaleDateString('nl-NL', {
            weekday: 'long',
            day: 'numeric',
            month: 'long'
          })}
        </h2>
      )}

      <div class="flex justify-center items-center gap-4 mb-10">
        <div class="h-px w-20 bg-gradient-to-r from-transparent to-gray-300"></div>
        <div class="text-secondary font-black text-xl italic tracking-tighter">
          {dagTitel && new Date(dagTitel).getFullYear()}
        </div>
        <div class="h-px w-20 bg-gradient-to-l from-transparent to-gray-300"></div>
      </div>

      {blok.headline && blok.headline !== blok.TitelProgramma && (
        <p class="text-xl md:text-2xl text-gray-500 font-medium max-w-2xl mx-auto leading-relaxed">
          {blok.headline}
        </p>
      )}
    </div>

    {/* Filter Bar */}
    {hasFilters && (
      <div class="sticky top-4 z-30 mb-16 flex justify-center">
        <div class="bg-white/80 backdrop-blur-md p-2 rounded-full shadow-xl border border-white/20 flex flex-wrap justify-center gap-2 max-w-full overflow-x-auto no-scrollbar">
          <button
            @click="activeFilter = 'all'"
            :class="activeFilter === 'all' ? 'bg-primary text-white shadow-md' : 'text-gray-600 hover:bg-gray-100'"
            class="px-6 py-2 rounded-full text-sm font-bold transition-all duration-300 whitespace-nowrap"
          >
            Alles
          </button>
          {locations.map((loc: any) => (
            <button
              @click={`activeFilter = '${loc}'`}
              :class={`activeFilter === '${loc}' ? 'bg-primary text-white shadow-md' : 'text-gray-600 hover:bg-gray-100'`}
              class="px-6 py-2 rounded-full text-sm font-bold transition-all duration-300 whitespace-nowrap"
            >
              {loc}
            </button>
          ))}
        </div>
      </div>
    )}
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 lg:gap-10">
      {
        blok.Programmas?.map((prog: any) => {
          const location = prog.Locatie || prog.locatie || 'all';
          return (
            <div
              class="flex justify-center transition-all duration-500"
              x-show={`activeFilter === 'all' || activeFilter === '${location}'`}
              x-transition:enter="transition ease-out duration-300"
              x-transition:enter-start="opacity-0 scale-95"
              x-transition:enter-end="opacity-100 scale-100"
            >
              <StoryblokComponent blok={prog} />
            </div>
          )
        })
      }
    </div>
  </div>
</section>

<script src="https://unpkg.com/alpinejs" defer></script>

<style>
  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }
  .no-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>
