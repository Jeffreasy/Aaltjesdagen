---
/**
 * Link Component
 *
 * Unified link component with multiple visual variants and automatic active state detection.
 * Supports navigation links, footer links, inline content links, and button-style links.
 *
 * @component
 */
import type { LinkProps } from "@/types/navigation";

interface Props extends LinkProps {
  /** Link content (passed via slot) */
}

const {
  href,
  variant = "nav",
  active: activeProp,
  external = false,
  class: className = "",
  ariaLabel,
} = Astro.props;

// Determine active state based on current URL
const currentPath = Astro.url.pathname;
const isActive =
  activeProp !== undefined
    ? activeProp
    : currentPath === href || (href !== "/" && currentPath.startsWith(href));

// External link attributes
const externalAttrs = external
  ? { target: "_blank", rel: "noopener noreferrer" }
  : {};
---

<a
  href={href}
  class:list={[
    "link",
    `link--${variant}`,
    { "link--active": isActive },
    className,
  ]}
  aria-current={isActive ? "page" : undefined}
  aria-label={ariaLabel}
  {...externalAttrs}
>
  <slot />

  {variant === "nav" && <span class="link__underline" aria-hidden="true" />}
</a>

<style>
  /* === BASE LINK STYLES === */
  .link {
    text-decoration: none;
    transition: all var(--transition-base);
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
  }

  .link:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 4px;
    border-radius: 4px;
  }

  /* === NAV VARIANT === */
  /* Used in main navigation (desktop header) */
  .link--nav {
    color: var(--text-secondary);
    padding: 0.5rem 0;
    flex-direction: column;
    font-size: 0.875rem;
    font-weight: 500;
    position: relative;
  }

  .link--nav:hover {
    color: #ff7e67; /* Coral - Direct value to bypass variable resolution issue */
  }

  .link--nav.link--active {
    color: var(--color-primary);
    font-weight: 600;
  }

  /* Nav Underline Indicator */
  .link__underline {
    display: block;
    height: 2px;
    width: 0;
    background: var(--color-secondary);
    transition: width var(--transition-base);
    border-radius: 1px;
  }

  .link--nav:hover .link__underline {
    width: 100%;
  }

  .link--nav.link--active .link__underline {
    width: 100%;
    background: var(--color-primary);
  }

  /* === FOOTER VARIANT === */
  /* Used in footer navigation */
  .link--footer {
    color: var(--text-secondary);
    font-size: 0.875rem;
  }

  .link--footer:hover {
    color: #50b0ae; /* Teal - Direct value to bypass variable resolution issue */
    transform: translateX(2px);
  }

  .link--footer.link--active {
    color: var(--color-primary);
    font-weight: 500;
  }

  /* === INLINE VARIANT === */
  /* Used within prose/content blocks */
  .link--inline {
    color: var(--color-primary);
    text-decoration: underline;
    text-underline-offset: 2px;
    text-decoration-thickness: 1px;
  }

  .link--inline:hover {
    color: #3a8e8c; /* Teal dark - Direct value to bypass variable resolution issue */
    text-decoration-thickness: 2px;
  }

  /* === BUTTON VARIANT === */
  /* Link styled as a button (for CTAs) */
  .link--button {
    padding: 0.625rem 1.5rem;
    border-radius: 0.5rem;
    background: var(--color-primary);
    color: var(--text-inverse);
    font-weight: 600;
    font-size: 0.875rem;
    box-shadow: var(--shadow-md);
  }

  .link--button:hover {
    background: var(--color-primary-dark);
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .link--button:active {
    transform: translateY(0);
  }

  /* === REDUCED MOTION === */
  @media (prefers-reduced-motion: reduce) {
    .link,
    .link__underline {
      transition: none !important;
    }

    .link:hover {
      transform: none !important;
    }
  }
</style>
